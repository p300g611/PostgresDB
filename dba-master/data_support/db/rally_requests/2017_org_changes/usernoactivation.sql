-- duplicate org in MO
with cte
as(
select 
a.id,count(distinct uo.organizationid) from aartuser a
inner join usersorganizations uo on a.id=uo.aartuserid
inner Join organization o on o.id=uo.organizationid
inner join userorganizationsgroups ug on ug.userorganizationid=uo.id
inner join groups g on g.id=ug.groupid
inner join userassessmentprogram ua on ua.aartuserid=a.id and ua.userorganizationsgroupsid=ug.id
where a.activeflag is true and a.activeflag is true and 
      uo.activeflag is true and ug.activeflag is true and ua.activeflag is true
      and 9591=(select id from organization_parent(o.id) where organizationtypeid=2 limit 1)
      and o.displayidentifier in ('01724',
'0010914030',
'0020977500',
'0030337500',
'0041101100',
'0051234020',
'0051281100',
'0051284020',
'0061041100',
'0061044040',
'0081074060',
'0100874010',
'0100894040',
'0100914020',
'0100931015',
'0100931100',
'0100935050',
'0110821100',
'0121084040',
'0121091100',
'0121095020',
'0121097500',
'0141304010',
'0150021015',
'0150021100',
'0150024020',
'0160904015',
'0160904060',
'0160961100',
'0171251100',
'0171254000',
'0191484020',
'0191491015',
'0191491100',
'0191494060',
'0191527500',
'0220894030',
'0230994020',
'0240874020',
'0240891100',
'0240901015',
'0240907500',
'0240934280',
'0240937500',
'0250011020',
'0260061015',
'0260061100',
'0260067500',
'0270611100',
'0270614020',
'0290033000',
'0300931100',
'0300934040',
'0330904020',
'0351021100',
'0351024040',
'0351027500',
'0361267520',
'0361267540',
'0361364020',
'0361374040',
'0361391100',
'0361394080',
'0361397500',
'0391347500',
'0391394020',
'0391411015',
'0391417500',
'0410021100',
'0410024030',
'0421241100',
'0421244070',
'0461341100',
'0470621100',
'0480661015',
'0480661100',
'0480667500',
'0480697500',
'0480704040',
'0480711015',
'0480717500',
'0480724055',
'0480727500',
'0480731100',
'0480737500',
'0480776080',
'0480777500',
'0480777510',
'0480781100',
'0480783180',
'0480784060',
'0480785360',
'0480807500',
'0491324040',
'0491421100',
'0491444040',
'0491444080',
'0491445010',
'0491447500',
'0491481100',
'0491487500',
'0500017500',
'0500031015',
'0500034080',
'0500074020',
'0500104030',
'0500127500',
'0500147500',
'0511591015',
'0511591100',
'0511594030',
'0511594070',
'0531112050',
'0531134020',
'0531134040',
'0540451100',
'0551084020',
'0551104020',
'0570044020',
'0570444040',
'0581121100',
'0591171100',
'0591174030',
'0591174040',
'0600774050',
'0600774070',
'0611561100',
'0620724020',
'0640751100',
'0661021100',
'0661054020',
'0670554040',
'0710924040',
'0720741100',
'0731084060',
'0742011100',
'0780131020',
'0780131100',
'0780134020',
'0790771100',
'0790771100',
'0801257500',
'0810961100',
'0821011100',
'0830014020',
'0830031100',
'0830034040',
'0830034050',
'0830057500',
'0840014020',
'0850464040',
'0870834020',
'0880811100',
'0880814060',
'0880814080',
'0890894020',
'0910921100',
'0920874040',
'0920874060',
'0920887500',
'0920887520',
'0920887530',
'0920894020',
'0920897500',
'0920901100',
'0920914030',
'0940781015',
'0940781020',
'0940787500',
'0940831100',
'0940834020',
'0940864020',
'0960887500',
'0960887510',
'0960887520',
'0960897500',
'0960907500',
'0960917500',
'0960927500',
'0960947500',
'0960951085',
'0960984040',
'0961017500',
'0961027500',
'0961074080',
'0961094180',
'0961117530',
'0961127500',
'0961144050',
'0961191015',
'0971291100',
'0971294020',
'0971295000',
'0990784020',
'1000631100',
'1000634020',
'1031311015',
'1031324040',
'1040441100',
'1040444020',
'1060044060',
'1060054010',
'1081421100',
'1081424020',
'1081424040',
'1090024040',
'1100144020',
'1100314020',
'1121024020',
'1141141015',
'1141141100',
'1151151550',
'1151153400',
'1151155930',
'1151156030',
'1159216985',
'1159226990',
'4014011050',
'4014014020')
group by a.id
having count(distinct uo.organizationid)>1)
select count(*) from cte;

--last modifieddate for D0259
select a.email, a.id,a.activeflag,a.modifieddate,a.createddate,o.organizationname,uo.activeflag orgactive from aartuser  a
   inner join usersorganizations uo on a.id=uo.aartuserid
   inner join organization o on o.id=uo.organizationid
   where 'D0259'=displayidentifier
   order by a.modifieddate desc;

   --
   select a.email,a.id,a.activeflag,a.modifieddate,a.createddate,o.organizationname,uo.activeflag orgactive from aartuser  a
   inner join usersorganizations uo on a.id=uo.aartuserid
    inner join organization o on o.id=uo.organizationid
    where o.id in (select id from organization_children(261))
    order by a.modifieddate desc;
-- no activation number
select 
case when (select organizationname  from organization_parent(o.id) where organizationtypeid=2) is null then o.organizationname
else (select organizationname  from organization_parent(o.id) where organizationtypeid=2) end  State,
a.id,
a.email Email,
a.firstname || ' '|| a.surname "name",
a.createddate Createdate,
a.modifieddate Modifydate,
a.activeflag activeflag,
am.email Modifyinguseremail,
am.firstname || ' '|| am.surname Modifyingusername,
o.organizationname organizationname,
ot.typecode organizationlevel,
uo.activeflag orgactive  from aartuser a
inner join aartuser am on a.modifieduser=am.id
inner join usersorganizations uo on a.id=uo.aartuserid
inner Join organization o on o.id=uo.organizationid
inner join organizationtype ot on ot.id=o.organizationtypeid
inner join userorganizationsgroups ug on ug.userorganizationid=uo.id
inner join groups g on g.id=ug.groupid
inner join userassessmentprogram ua on ua.aartuserid=a.id and ua.userorganizationsgroupsid=ug.id
where a.activeflag is true and a.activeflag is true and 
      uo.activeflag is true and ug.activeflag is true and ua.activeflag is true
      and coalesce(activationno,'')=''